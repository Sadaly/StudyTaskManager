# StudyTaskManager [WIP]

**StudyTaskManager** ‚Äî —ç—Ç–æ –≤–µ–±-–ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ –¥–ª—è —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è —É—á–µ–±–Ω—ã–º–∏ –∑–∞–¥–∞—á–∞–º–∏, —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω–Ω–æ–µ –≤ —Ä–∞–º–∫–∞—Ö –≥—Ä—É–ø–ø–æ–≤–æ–≥–æ –ø—Ä–æ–µ–∫—Ç–∞ –ø–æ –¥–∏—Å—Ü–∏–ø–ª–∏–Ω–µ Web-—Ç–µ—Ö–Ω–æ–ª–æ–≥–∏–∏.  
–ü–æ—Å—Ç—Ä–æ–µ–Ω–æ –Ω–∞ –±–∞–∑–µ ASP.NET Core —Å –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ–º MediatR, Entity Framework Core, FluentValidation –∏ JWT-–∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏–∏. –ü—Ä–æ–µ–∫—Ç —Å–ª–µ–¥—É–µ—Ç –º–æ–¥—É–ª—å–Ω–æ–π –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–µ –∏ —Å–æ–≤—Ä–µ–º–µ–Ω–Ω—ã–º –ø–æ–¥—Ö–æ–¥–∞–º –∫ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏—é, –≤–∞–ª–∏–¥–∞—Ü–∏–∏ –∏ –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏.

---

## ‚öôÔ∏è –¢–µ—Ö–Ω–æ–ª–æ–≥–∏–∏ –∏ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç—ã

- **ASP.NET Core Web API** ‚Äî —Å–æ–∑–¥–∞–Ω–∏–µ HTTP API  
- **Entity Framework Core (PostgreSQL)** ‚Äî —Ä–∞–±–æ—Ç–∞ —Å –±–∞–∑–æ–π –¥–∞–Ω–Ω—ã—Ö  
- **MediatR** ‚Äî —Ä–µ–∞–ª–∏–∑–∞—Ü–∏—è –ø–∞—Ç—Ç–µ—Ä–Ω–∞ CQRS  
- **FluentValidation** ‚Äî –≤–∞–ª–∏–¥–∞—Ü–∏—è –≤—Ö–æ–¥—è—â–∏—Ö –∑–∞–ø—Ä–æ—Å–æ–≤  
- **Serilog** ‚Äî –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ HTTP-–∑–∞–ø—Ä–æ—Å–æ–≤ –∏ –≤–Ω—É—Ç—Ä–µ–Ω–Ω–∏—Ö —Å–æ–±—ã—Ç–∏–π  
- **JWT-–∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏—è** ‚Äî –∑–∞—â–∏—Ç–∞ API –∏ —É–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –¥–æ—Å—Ç—É–ø–æ–º  
- **Swagger (Swashbuckle)** ‚Äî –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è –≥–µ–Ω–µ—Ä–∞—Ü–∏—è –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏–∏ API  
- **CORS** ‚Äî —Ä–∞–∑—Ä–µ—à–µ–Ω–∏–µ –∑–∞–ø—Ä–æ—Å–æ–≤ —Å –∫–ª–∏–µ–Ω—Ç—Å–∫–æ–≥–æ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è  

---

## üîí –ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å

- JWT-–∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏—è —á–µ—Ä–µ–∑ `Microsoft.AspNetCore.Authentication.JwtBearer`  
- –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è —Ç–æ–∫–µ–Ω–æ–≤ —á–µ—Ä–µ–∑ –∫–∞—Å—Ç–æ–º–Ω—ã–µ `JwtOptionsSetup` –∏ `JwtBearerOptionsSetup`  
- –ê–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—è –ø–æ —Ä–æ–ª—è–º —Å –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ–º –∞—Ç—Ä–∏–±—É—Ç–∞ `[Authorize(Roles = "...")]`  
- –•—Ä–∞–Ω–µ–Ω–∏–µ access-—Ç–æ–∫–µ–Ω–∞ –≤ `HttpOnly` Cookie –¥–ª—è –ø–æ–≤—ã—à–µ–Ω–∏—è –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏  

---

## üìë Swagger

- –ü–æ–¥–¥–µ—Ä–∂–∫–∞ –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏ —á–µ—Ä–µ–∑ JWT  
- –ö–Ω–æ–ø–∫–∞ **Authorize** –≤ Swagger UI  
- –ü–µ—Ä–µ–¥–∞—á–∞ —Ç–æ–∫–µ–Ω–∞ –≤ –∑–∞–≥–æ–ª–æ–≤–∫–µ `Authorization: Bearer {token}`  

---

## ‚úÖ –û—Å–Ω–æ–≤–Ω—ã–µ –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç–∏ –ø—Ä–æ–µ–∫—Ç–∞

- **CQRS —Å MediatR:** –≤—Å–µ –¥–µ–π—Å—Ç–≤–∏—è —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω—ã —á–µ—Ä–µ–∑ –∫–æ–º–∞–Ω–¥—ã –∏ –∑–∞–ø—Ä–æ—Å—ã  
- **–§–∏–ª—å—Ç—Ä–∞—Ü–∏—è:** —á–µ—Ä–µ–∑ `Expression<Func<T, bool>>`, –ø—Ä–∏–º–µ–Ω—è–µ—Ç—Å—è –∫ –∑–∞–ø—Ä–æ—Å–∞–º LINQ  
- **–ü–∞–≥–∏–Ω–∞—Ü–∏—è:** –ø–æ–¥–¥–µ—Ä–∂–∫–∞ —Ñ–∏–ª—å—Ç—Ä–æ–≤ –∏ –ø–æ—Å—Ç—Ä–∞–Ω–∏—á–Ω–æ–≥–æ –≤—ã–≤–æ–¥–∞ –≤ –æ–¥–Ω–æ–º –æ–±—ä–µ–∫—Ç–µ  
- **–í–∞–ª–∏–¥–∞—Ü–∏—è:** FluentValidation –¥–ª—è –¥–µ–∫–ª–∞—Ä–∞—Ç–∏–≤–Ω–æ–π –ø—Ä–æ–≤–µ—Ä–∫–∏ –≤—Ö–æ–¥—è—â–∏—Ö –¥–∞–Ω–Ω—ã—Ö  
- **–¶–µ–Ω—Ç—Ä–∞–ª–∏–∑–æ–≤–∞–Ω–Ω–∞—è –æ–±—Ä–∞–±–æ—Ç–∫–∞ –æ—à–∏–±–æ–∫:**  
  - –í–æ–∑–≤—Ä–∞—â–∞–µ—Ç 400 Bad Request –ø—Ä–∏ –æ—à–∏–±–∫–∞—Ö  
  - –§–æ—Ä–º–∏—Ä—É–µ—Ç `ProblemDetails` –≤ –µ–¥–∏–Ω–æ–º —Ñ–æ—Ä–º–∞—Ç–µ  
  - –ü–æ–¥–¥–µ—Ä–∂–∫–∞ –≤–∞–ª–∏–¥–∞—Ü–∏–æ–Ω–Ω—ã—Ö –æ—à–∏–±–æ–∫ —á–µ—Ä–µ–∑ `IValidationResult` —Å –º–∞—Å—Å–∏–≤–æ–º `Error[]`  
- **–ê–±—Å—Ç—Ä–∞–∫—Ç–Ω—ã–π –∫–æ–Ω—Ç—Ä–æ–ª–ª–µ—Ä `ApiController`:** –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Å MediatR –∏ —Ü–µ–Ω—Ç—Ä–∞–ª–∏–∑–æ–≤–∞–Ω–Ω–∞—è –æ–±—Ä–∞–±–æ—Ç–∫–∞ –æ—à–∏–±–æ–∫  
![image](https://github.com/user-attachments/assets/b1453d19-4e8e-4f25-a5ec-4b2def0493cb)
![image](https://github.com/user-attachments/assets/faba8347-4f3c-470c-8988-0cce583d9ede)

---

## üß± –î–æ–º–µ–Ω–Ω—ã–µ –ø–∞—Ç—Ç–µ—Ä–Ω—ã

### Value Object (DDD)

- –ê–±—Å—Ç—Ä–∞–∫—Ç–Ω—ã–π –∫–ª–∞—Å—Å `ValueObject` ‚Äî –æ—Å–Ω–æ–≤–∞ –¥–ª—è –æ–±—ä–µ–∫—Ç–æ–≤-–∑–Ω–∞—á–µ–Ω–∏–π  
- –°—Ä–∞–≤–Ω–µ–Ω–∏–µ –ø–æ –∞—Ç–æ–º–∞—Ä–Ω—ã–º —Å–≤–æ–π—Å—Ç–≤–∞–º, –∞ –Ω–µ –ø–æ –∏–¥–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ç–æ—Ä—É  
- –†–µ–∞–ª–∏–∑–æ–≤–∞–Ω—ã –º–µ—Ç–æ–¥—ã `GetAtomicValues()`, `Equals(...)`, `GetHashCode()`  
- –ü—Ä–∏–º–µ—Ä—ã –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è: Email, Username, PhoneNumber, Password

```csharp
namespace StudyTaskManager.Domain.Common;

/// <summary>
/// –ë–∞–∑–æ–≤—ã–π –∫–ª–∞—Å—Å –¥–ª—è –æ–±—ä–µ–∫—Ç–æ–≤-–∑–Ω–∞—á–µ–Ω–∏–π (Value Objects) –≤ Domain-Driven Design.
/// –û–±—ä–µ–∫—Ç—ã-–∑–Ω–∞—á–µ–Ω–∏—è –∏–¥–µ–Ω—Ç–∏—Ñ–∏—Ü–∏—Ä—É—é—Ç—Å—è –ø–æ –∏—Ö —Å–≤–æ–π—Å—Ç–≤–∞–º, –∞ –Ω–µ –ø–æ –∏–¥–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ç–æ—Ä—É.
/// </summary>
public abstract class ValueObject : IEquatable<ValueObject>
{
    /// <summary>
    /// –í–æ–∑–≤—Ä–∞—â–∞–µ—Ç –∑–Ω–∞—á–µ–Ω–∏—è –≤—Å–µ—Ö —Å–≤–æ–π—Å—Ç–≤ –æ–±—ä–µ–∫—Ç–∞-–∑–Ω–∞—á–µ–Ω–∏—è.
    /// </summary>
    /// <returns>–ö–æ–ª–ª–µ–∫—Ü–∏—è –∑–Ω–∞—á–µ–Ω–∏–π —Å–≤–æ–π—Å—Ç–≤.</returns>
    public abstract IEnumerable<object> GetAtomicValues();

    /// <summary>
    /// –°—Ä–∞–≤–Ω–∏–≤–∞–µ—Ç —Ç–µ–∫—É—â–∏–π –æ–±—ä–µ–∫—Ç-–∑–Ω–∞—á–µ–Ω–∏–µ —Å –¥—Ä—É–≥–∏–º –æ–±—ä–µ–∫—Ç–æ–º-–∑–Ω–∞—á–µ–Ω–∏–µ–º.
    /// </summary>
    /// <param name="other">–î—Ä—É–≥–æ–π –æ–±—ä–µ–∫—Ç-–∑–Ω–∞—á–µ–Ω–∏–µ –¥–ª—è —Å—Ä–∞–≤–Ω–µ–Ω–∏—è.</param>
    /// <returns>True, –µ—Å–ª–∏ –æ–±—ä–µ–∫—Ç—ã —Ä–∞–≤–Ω—ã; –∏–Ω–∞—á–µ False.</returns>
    public bool Equals(ValueObject? other)
    {
        return other is not null && ValuesAreEqual(other);
    }

    /// <summary>
    /// –°—Ä–∞–≤–Ω–∏–≤–∞–µ—Ç —Ç–µ–∫—É—â–∏–π –æ–±—ä–µ–∫—Ç-–∑–Ω–∞—á–µ–Ω–∏–µ —Å –¥—Ä—É–≥–∏–º –æ–±—ä–µ–∫—Ç–æ–º.
    /// </summary>
    /// <param name="obj">–î—Ä—É–≥–æ–π –æ–±—ä–µ–∫—Ç –¥–ª—è —Å—Ä–∞–≤–Ω–µ–Ω–∏—è.</param>
    /// <returns>True, –µ—Å–ª–∏ –æ–±—ä–µ–∫—Ç—ã —Ä–∞–≤–Ω—ã; –∏–Ω–∞—á–µ False.</returns>
    public override bool Equals(object? obj)
    {
        return obj is ValueObject other && ValuesAreEqual(other);
    }

    /// <summary>
    /// –í—ã—á–∏—Å–ª—è–µ—Ç —Ö—ç—à-–∫–æ–¥ –Ω–∞ –æ—Å–Ω–æ–≤–µ –∑–Ω–∞—á–µ–Ω–∏–π —Å–≤–æ–π—Å—Ç–≤ –æ–±—ä–µ–∫—Ç–∞-–∑–Ω–∞—á–µ–Ω–∏—è.
    /// </summary>
    /// <returns>–•—ç—à-–∫–æ–¥ –æ–±—ä–µ–∫—Ç–∞.</returns>
    public override int GetHashCode()
    {
        return GetAtomicValues()
            .Aggregate(
                default(int),
                HashCode.Combine);
    }

    /// <summary>
    /// –ü—Ä–æ–≤–µ—Ä—è–µ—Ç, —Ä–∞–≤–Ω—ã –ª–∏ –∑–Ω–∞—á–µ–Ω–∏—è —Å–≤–æ–π—Å—Ç–≤ —Ç–µ–∫—É—â–µ–≥–æ –æ–±—ä–µ–∫—Ç–∞ –∏ –¥—Ä—É–≥–æ–≥–æ –æ–±—ä–µ–∫—Ç–∞-–∑–Ω–∞—á–µ–Ω–∏—è.
    /// </summary>
    /// <param name="other">–î—Ä—É–≥–æ–π –æ–±—ä–µ–∫—Ç-–∑–Ω–∞—á–µ–Ω–∏–µ –¥–ª—è —Å—Ä–∞–≤–Ω–µ–Ω–∏—è.</param>
    /// <returns>True, –µ—Å–ª–∏ –∑–Ω–∞—á–µ–Ω–∏—è —Å–≤–æ–π—Å—Ç–≤ —Ä–∞–≤–Ω—ã; –∏–Ω–∞—á–µ False.</returns>
    private bool ValuesAreEqual(ValueObject other)
    {
        return GetAtomicValues().SequenceEqual(other.GetAtomicValues());
    }
}
```

### Outbox Pattern (–ì–∞—Ä–∞–Ω—Ç–∏—Ä–æ–≤–∞–Ω–Ω–∞—è –¥–æ—Å—Ç–∞–≤–∫–∞ —Å–æ–±—ã—Ç–∏–π)

- –°–æ–±—ã—Ç–∏—è —Å–æ—Ö—Ä–∞–Ω—è—é—Ç—Å—è –≤ —Ç–∞–±–ª–∏—Ü—É `OutboxMessages` –≤ —Ä–∞–º–∫–∞—Ö –æ–¥–Ω–æ–π —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏  
- –§–æ–Ω–æ–≤–∞—è –∑–∞–¥–∞—á–∞ `ProcessOutboxMessagesJob` –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç –∏ –ø—É–±–ª–∏–∫—É–µ—Ç —Å–æ–±—ã—Ç–∏—è —á–µ—Ä–µ–∑ MediatR  
- Atomic persistence –∏ fail-safe –ø–æ–≤—Ç–æ—Ä–Ω–∞—è –¥–æ—Å—Ç–∞–≤–∫–∞  
- –ü–µ—Ä–µ—Ö–≤–∞—Ç—á–∏–∫ `ConvertDomainEventsToOutboxMessagesInterceptor` –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –∫–æ–Ω–≤–µ—Ä—Ç–∏—Ä—É–µ—Ç –¥–æ–º–µ–Ω–Ω—ã–µ —Å–æ–±—ã—Ç–∏—è –≤ Outbox-—Å–æ–æ–±—â–µ–Ω–∏—è –ø—Ä–∏ –≤—ã–∑–æ–≤–µ `SaveChangesAsync`  
![image](https://github.com/user-attachments/assets/96347de2-0a7a-4cb2-bdaf-72761a6cf261)

---

## üì¶ Persistence Layer: Generic Repository

- –ê–±—Å—Ç—Ä–∞–∫—Ç–Ω—ã–π –∫–ª–∞—Å—Å `TRepository<T>` —Ä–µ–∞–ª–∏–∑—É–µ—Ç `IRepository<T>`  
- –ü–æ–¥–¥–µ—Ä–∂–∫–∞ –≥–∏–±–∫–æ–≥–æ –ø–æ–ª—É—á–µ–Ω–∏—è –¥–∞–Ω–Ω—ã—Ö —Å –ø—Ä–µ–¥–∏–∫–∞—Ç–∞–º–∏ –∏ –ø–∞–≥–∏–Ω–∞—Ü–∏–µ–π  
- –í–∞–ª–∏–¥–∞—Ü–∏—è —á–µ—Ä–µ–∑ —Ö—É–∫–∏:  
  - `VerificationBeforeAddingAsync`  
  - `VerificationBeforeUpdateAsync`  
  - `VerificationBeforeRemoveAsync`  
- –ú–µ—Ç–æ–¥—ã CRUD —Å –ø–æ–¥–¥–µ—Ä–∂–∫–æ–π `AsNoTracking`  
- –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ `Result<T>` –¥–ª—è –æ–±—Ä–∞–±–æ—Ç–∫–∏ –æ—à–∏–±–æ–∫ –∏ —É—Å–ø–µ—à–Ω—ã—Ö —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤  
- –ò–Ω–∫–∞–ø—Å—É–ª—è—Ü–∏—è –¥–æ—Å—Ç—É–ø–∞ –∫ `AppDbContext` –∏ `DbSet<T>`  

---

## üóÑ AppDbContext

- –û—Å–Ω–æ–≤–Ω–æ–π –∫–ª–∞—Å—Å –¥–ª—è —Ä–∞–±–æ—Ç—ã —Å –±–∞–∑–æ–π –¥–∞–Ω–Ω—ã—Ö (EF Core)  
- DbSet-—Å–≤–æ–π—Å—Ç–≤–∞ –¥–ª—è –≤—Å–µ—Ö –¥–æ–º–µ–Ω–Ω—ã—Ö —Å—É—â–Ω–æ—Å—Ç–µ–π (–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏, –†–æ–ª–∏, –ß–∞—Ç—ã, –ó–∞–¥–∞—á–∏ –∏ –¥—Ä.)  
- –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ —Å–æ–∑–¥–∞–Ω–∏–µ –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö –ø—Ä–∏ –ø–µ—Ä–≤–æ–º –∑–∞–ø—É—Å–∫–µ (`Database.EnsureCreated()`)  
- –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏ —Å—É—â–Ω–æ—Å—Ç–µ–π –≤ –ø–∞–ø–∫–µ `Configurations`  
- –ù–∞—Å—Ç—Ä–æ–π–∫–∞ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è –∫ PostgreSQL  
![image](https://github.com/user-attachments/assets/cbe07b26-c5df-445a-a41d-6a18a4bc46b6)

---

## üèó UnitOfWork

- –ò–Ω–∫–∞–ø—Å—É–ª–∏—Ä—É–µ—Ç –≤—ã–∑–æ–≤ `_dbContext.SaveChangesAsync()`  
- –û–±–µ—Å–ø–µ—á–∏–≤–∞–µ—Ç –∞—Ç–æ–º–∞—Ä–Ω–æ—Å—Ç—å —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è –∏–∑–º–µ–Ω–µ–Ω–∏–π –≤ –±–∞–∑–µ –¥–∞–Ω–Ω—ã—Ö  

```csharp
internal sealed class UnitOfWork : IUnitOfWork
{
    private readonly AppDbContext _dbContext;

    public UnitOfWork(AppDbContext dbContext)
    {
        _dbContext = dbContext;
    }

    public async Task SaveChangesAsync(CancellationToken cancellationToken = default)
    {
        await _dbContext.SaveChangesAsync(cancellationToken);
    }
}
```
